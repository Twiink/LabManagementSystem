# 实验室管理系统前端项目文档

## 一、项目概述

### 1.1 项目简介

实验室管理系统（Lab Management System）前端是一个基于 Vue 3 + TypeScript 的现代化单页应用（SPA），用于管理实验室资源预约、设备管理、课程安排等业务功能。系统采用角色分级设计，支持学生、教师、管理员三种角色，提供差异化的功能权限和界面展示。

### 1.2 技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Vue | 3.5.24 | 前端框架 |
| TypeScript | 5.9.3 | 类型安全 |
| Vite | 7.2.4 | 构建工具 |
| Vue Router | 4.6.4 | 路由管理 |
| Pinia | 3.0.4 | 状态管理 |
| Element Plus | 2.13.0 | UI组件库 |
| Axios | 1.13.2 | HTTP客户端 |
| ECharts | 6.0.0 | 图表可视化 |
| Sass | 1.97.1 | CSS预处理器 |

### 1.3 设计特点

1. **Composition API**: 全局使用 Vue 3 的 Composition API (`<script setup>`) 语法，提供更好的逻辑复用和类型推断
2. **TypeScript 强类型**: 所有 API 响应、请求参数、业务类型都有完整的类型定义
3. **模块化架构**: 按功能模块划分目录，职责清晰
4. **统一错误处理**: Axios 拦截器统一处理认证错误和业务错误
5. **角色权限控制**: 路由层面实现基于角色的访问控制

---

## 二、项目结构

```
LabManagementSystemFrontend/
├── public/                  # 静态资源（构建时直接复制）
│   └── vite.svg            # Vite图标
├── src/
│   ├── api/                 # API接口层
│   │   ├── request.ts       # Axios二次封装
│   │   ├── index.ts         # API统一导出
│   │   ├── types.ts         # 全局类型定义
│   │   ├── auth.ts          # 认证相关API
│   │   ├── user.ts          # 用户管理API
│   │   ├── lab.ts           # 实验室管理API
│   │   ├── device.ts        # 设备管理API
│   │   ├── course.ts        # 课程管理API
│   │   ├── reservation.ts   # 预约管理API
│   │   ├── calendar.ts      # 日历视图API
│   │   ├── notification.ts  # 通知API
│   │   ├── auditLog.ts      # 审计日志API
│   │   └── ruleConfig.ts    # 规则配置API
│   ├── assets/              # 资源文件（会被Vite处理）
│   │   └── vue.svg
│   ├── components/          # 公共组件（本项目未使用，组件内联在视图中）
│   ├── layout/              # 布局组件
│   │   └── Layout.vue       # 主布局（侧边栏+头部+内容区）
│   ├── router/              # 路由配置
│   │   └── index.ts         # 路由定义和导航守卫
│   ├── store/               # Pinia状态管理
│   │   └── user.ts          # 用户状态（Token、用户信息）
│   ├── styles/              # 全局样式
│   │   ├── glass.scss       # 玻璃拟态设计变量
│   │   └── ...
│   ├── utils/               # 工具函数
│   │   └── time.ts          # 时间格式化工具
│   ├── views/               # 页面视图
│   │   ├── login/           # 登录注册页
│   │   │   ├── Login.vue
│   │   │   └── Register.vue
│   │   ├── dashboard/       # 仪表盘
│   │   │   └── Dashboard.vue
│   │   ├── calendar/        # 预约日历
│   │   │   └── LabCalendar.vue
│   │   ├── labs/            # 实验室管理
│   │   │   └── LabList.vue
│   │   ├── devices/         # 设备管理
│   │   │   └── DeviceList.vue
│   │   ├── courses/         # 课程管理
│   │   │   └── CourseList.vue
│   │   ├── reservations/    # 预约管理
│   │   │   └── ReservationList.vue
│   │   └── admin/           # 管理员功能
│   │       ├── UserList.vue
│   │       └── AuditLogs.vue
│   ├── App.vue              # 根组件
│   ├── main.ts              # 应用入口
│   └── style.css            # 全局样式入口
├── index.html               # HTML模板
├── package.json             # 项目配置和依赖
├── vite.config.ts           # Vite构建配置
├── tsconfig.json            # TypeScript配置
└── tsconfig.app.json        # 应用TypeScript配置
```

---

## 三、核心文件详解

### 3.1 入口文件 `main.ts`

```typescript
import { createApp } from 'vue'
import './style.css'
import App from './App.vue'
import ElementPlus from 'element-plus'
import 'element-plus/dist/index.css'
import * as ElementPlusIconsVue from '@element-plus/icons-vue'
import router from './router'
import { createPinia } from 'pinia'

const app = createApp(App)

// 注册所有 Element Plus 图标为全局组件
for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
  app.component(key, component)
}

// 安装插件
app.use(createPinia())  // 状态管理
app.use(router)         // 路由
app.use(ElementPlus)    // UI组件库
app.mount('#app')
```

**设计要点**：
- **全局图标注册**: 一次性注册所有 Element Plus 图标，避免在每个组件中单独导入
- **插件顺序**: Pinia 和 Router 先于 Element Plus 安装，确保依赖可用
- **样式导入**: 全局样式在入口处导入，确保优先级正确

### 3.2 根组件 `App.vue`

```vue
<template>
  <router-view />
</template>

<script setup lang="ts">
</script>

<style>
#app {
  width: 100%;
  height: 100%;
}
</style>
```

**设计要点**：
- **路由出口**: 仅使用 `<router-view />` 作为根元素，所有页面通过路由渲染
- **极简设计**: 不包含任何业务逻辑，只作为路由容器

### 3.3 构建配置 `vite.config.ts`

```typescript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import path from 'path'

export default defineConfig({
  plugins: [vue()],

  // 路径别名配置
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src')
    }
  },

  // 开发服务器配置
  server: {
    port: 5173,
    host: true,
    // 代理配置：将 /api 请求转发到后端服务
    proxy: {
      '/api': {
        target: 'http://localhost:8080',  // 后端服务地址
        changeOrigin: true,                // 开启跨域
        secure: false                      // 允许非HTTPS
      }
    }
  }
})
```

**设计要点**：
- **路径别名**: 使用 `@` 代替 `src/` 路径，简化导入路径
- **API代理**: 开发环境下通过 Vite 代理解决跨域问题，生产环境需配合 Nginx
- **端口固定**: 5173 为 Vite 默认端口，host: true 允许局域网访问

---

## 四、API 层架构

### 4.1 Axios 二次封装 `request.ts`

这是整个前端最核心的通信层，进行了以下封装：

#### 4.1.1 类型定义

```typescript
// 后端统一响应结构
export interface ApiResponse<T = any> {
  code: number        // 业务状态码，0 表示成功
  message: string     // 响应消息
  data: T             // 响应数据
  requestId?: string  // 请求追踪 ID
}

// 分页响应数据结构
export interface PageData<T> {
  items: T[]       // 数据列表
  page: number     // 当前页码
  pageSize: number // 每页条数
  total: number    // 总记录数
}
```

**设计要点**：
- **统一响应格式**: 遵循后端 `ApiResponse` 封装规范
- **分页数据**: 封装 `PageData` 便于列表渲染

#### 4.1.2 错误码映射

```typescript
const ERROR_CODE_MAP: Record<number, string> = {
  4001: '预约时间窗不满足要求',
  4002: '资源时间冲突，请选择其他时间段',
  4003: '资源当前不可用（维护中/已停用/已报废）',
  4004: '已超出预约上限',
  4005: '权限不足，无法执行此操作',
  4006: '参数校验失败，请检查输入',
  4007: '当前预约状态不允许此操作',
  4008: '审批流程要求未满足',
  4009: '请求的资源不存在',
  4010: '登录已失效，请重新登录'
}
```

**设计要点**：
- **用户友好**: 将后端错误码转换为中文提示
- **可扩展**: 可随时添加新的错误码映射

#### 4.1.3 请求拦截器

```typescript
service.interceptors.request.use(
  (config: InternalAxiosRequestConfig) => {
    const userStore = useUserStore()
    const token = userStore.token

    if (token) {
      config.headers.Authorization = `Bearer ${token}`
    }
    return config
  }
)
```

**设计要点**：
- **自动携带 Token**: 从 Pinia Store 获取 JWT 并添加到请求头
- **静默处理**: 无 Token 时正常发起请求，由后端返回 401

#### 4.1.4 响应拦截器

```typescript
service.interceptors.response.use(
  (response: AxiosResponse<ApiResponse>) => {
    const res = response.data

    // 业务状态码为 0 表示成功
    if (res.code === 0) {
      return response
    }

    // 处理登录失效
    if (res.code === 4010) {
      handleUnauthorized()
      return Promise.reject(new Error(res.message || '登录已失效'))
    }

    // 处理其他业务错误
    const errorMessage = ERROR_CODE_MAP[res.code] || res.message || '请求失败'
    ElMessage.error(errorMessage)
    return Promise.reject(new Error(errorMessage))
  },
  (error) => {
    // 处理 HTTP 错误状态码
    // ... 401、403、404、500 等处理
  }
)
```

**设计要点**：
- **业务码判断**: 优先判断 `code === 0`，而非 HTTP 状态码
- **登录失效处理**: 4010 错误码触发重新登录流程
- **全局提示**: 使用 Element Plus 的 `ElMessage` 显示错误信息

#### 4.1.5 请求方法封装

```typescript
export function get<T>(url: string, params?: object, config?: AxiosRequestConfig): Promise<ApiResponse<T>> {
  return service.get(url, { params, ...config }).then(res => res.data)
}

export function post<T>(url: string, data?: object, config?: AxiosRequestConfig): Promise<ApiResponse<T>> {
  return service.post(url, data, config).then(res => res.data)
}

// PUT、PATCH、DELETE 同理
```

**设计要点**：
- **返回类型泛型**: 允许指定 `data` 字段的类型
- **自动解构**: 直接返回 `res.data`，调用方无需再解包
- **链式调用**: 使用 `.then()` 返回 Promise，便于使用 async/await

### 4.2 API 模块设计

每个业务模块对应一个 API 文件，采用以下规范：

**文件命名**: `api/模块名.ts`

**结构规范**:
1. 导入类型定义（从 `types.ts` 和 `request.ts`）
2. 定义请求参数类型（以 `Params` 结尾）
3. 导出 API 函数（默认导出或命名导出）

**示例 `api/lab.ts`**:
```typescript
export function getLabList(params?: LabListParams) {
  return get<PageData<Lab>>('/labs', params)
}

export function createLab(params: CreateLabParams) {
  return post<Lab>('/labs', params)
}

export function updateLab(id: number, params: UpdateLabParams) {
  return put<Lab>(`/labs/${id}`, params)
}

export function updateLabStatus(id: number, params: UpdateLabStatusParams) {
  return patch<Lab>(`/labs/${id}/status`, params)
}
```

### 4.3 类型定义 `types.ts`

**设计要点**：
- **枚举类型**: 集中定义所有枚举（UserRole、LabStatus、DeviceStatus、ReservationStatus 等）
- **接口对应**: 前端接口与后端实体类对应
- **业务类型**: 包含请求参数、响应数据、复合类型

---

## 五、路由系统

### 5.1 路由配置 `router/index.ts`

```typescript
const routes: Array<RouteRecordRaw> = [
  {
    path: '/login',
    name: 'Login',
    component: () => import('../views/login/Login.vue')
  },
  {
    path: '/register',
    name: 'Register',
    component: () => import('../views/login/Register.vue')
  },
  {
    path: '/',
    component: Layout,
    redirect: '/dashboard',
    children: [
      // 通用功能
      {
        path: 'dashboard',
        name: 'Dashboard',
        component: () => import('../views/dashboard/Dashboard.vue'),
        meta: { title: '首页', icon: 'House', roles: ['ADMIN', 'TEACHER', 'STUDENT'] }
      },
      {
        path: 'calendar',
        name: 'Calendar',
        component: () => import('../views/calendar/LabCalendar.vue'),
        meta: { title: '预约日历', icon: 'Calendar', roles: ['ADMIN', 'TEACHER', 'STUDENT'] }
      },
      // 学生/教师功能
      {
        path: 'labs',
        name: 'Labs',
        component: () => import('../views/labs/LabList.vue'),
        meta: { title: '实验室浏览', icon: 'OfficeBuilding', roles: ['STUDENT', 'TEACHER'] }
      },
      // 教师功能
      {
        path: 'course-manage',
        name: 'CourseManage',
        component: () => import('../views/courses/CourseList.vue'),
        meta: { title: '课程管理', icon: 'Notebook', roles: ['TEACHER'] }
      },
      // 管理员功能
      {
        path: 'lab-manage',
        name: 'LabManage',
        component: () => import('../views/labs/LabList.vue'),
        meta: { title: '实验室管理', icon: 'OfficeBuilding', roles: ['ADMIN'] }
      }
      // ... 其他路由
    ]
  }
]
```

**设计要点**：
1. **路由懒加载**: 使用动态导入 `import()` 实现代码分割
2. **角色权限**: `meta.roles` 数组定义可访问该路由的角色
3. **嵌套布局**: `/` 路径使用 `Layout` 作为父组件，内部 `children` 渲染在 `<router-view>` 中
4. **重定向**: 默认跳转到 `/dashboard`

### 5.2 菜单过滤逻辑 `Layout.vue`

```typescript
const menuRoutes = computed(() => {
  const userRole = userStore.userInfo?.role || 'GUEST'
  const mainRoute = router.options.routes.find(r => r.path === '/')
  if (!mainRoute || !mainRoute.children) return []

  return mainRoute.children.filter((child: any) => {
    if (child.meta && child.meta.roles) {
      return child.meta.roles.includes(userRole)
    }
    return true
  })
})
```

**设计要点**：
- **运行时过滤**: 根据当前用户角色动态过滤菜单项
- **默认路由**: 无 `roles` 定义的路由对所有角色可见

---

## 六、状态管理

### 6.1 用户 Store `store/user.ts`

使用 Pinia 的 Composition API 风格：

```typescript
export const useUserStore = defineStore('user', () => {
  // 状态
  const token = ref<string | null>(localStorage.getItem('token'))
  const userInfo = ref<User | null>(JSON.parse(localStorage.getItem('userInfo') || 'null'))

  // 计算属性
  const isLoggedIn = computed(() => !!token.value)
  const role = computed<UserRole | null>(() => userInfo.value?.role ?? null)
  const isAdmin = computed(() => role.value === 'ADMIN')
  const isTeacher = computed(() => role.value === 'TEACHER')
  const isStudent = computed(() => role.value === 'STUDENT')

  // 方法
  function setToken(newToken: string) {
    token.value = newToken
    localStorage.setItem('token', newToken)
  }

  function login(params: LoginParams) {
    const res = await loginApi(params)
    if (res.code === 0) {
      setToken(res.data.accessToken)
      setUserInfo(res.data.user)
    }
    return res
  }

  function logout() {
    token.value = null
    userInfo.value = null
    localStorage.removeItem('token')
    localStorage.removeItem('userInfo')
  }

  return {
    token,
    userInfo,
    isLoggedIn,
    role,
    isAdmin,
    isTeacher,
    isStudent,
    setToken,
    setUserInfo,
    login,
    logout
  }
})
```

**设计要点**：
1. **持久化存储**: Token 和用户信息存储在 localStorage，页面刷新后保持登录状态
2. **计算属性**: `isAdmin`、`isTeacher`、`isStudent` 便于权限判断
3. **响应式**: 所有状态都是响应式的，修改后自动更新依赖处

---

## 七、视图组件设计

### 7.1 布局组件 `Layout.vue`

**结构**:
```
+------------------+--------------------------------------------------+
|                  |  Header (面包屑 + 用户信息 + 登出)               |
|                  +--------------------------------------------------+
|    Sidebar       |                                                  |
|  (侧边栏菜单)     |              <router-view>                      |
|                  |                                                  |
|                  |               (页面内容)                         |
|                  |                                                  |
+------------------+--------------------------------------------------+
```

**功能**:
- **侧边栏**: 根据用户角色动态显示菜单项
- **折叠功能**: 点击可折叠侧边栏
- **面包屑**: 顶部导航显示当前页面路径
- **用户信息**: 右上角显示头像、名称、角色标签
- **过渡动画**: 页面切换时使用淡入淡出效果

### 7.2 页面组件规范

每个视图组件遵循以下模式：

```vue
<template>
  <!-- 页面容器 -->
  <div class="page-container">
    <!-- 筛选栏/操作栏 -->
    <div class="glass-card action-bar">
      <!-- 搜索、表单等 -->
    </div>

    <!-- 主要内容区 -->
    <div class="glass-card">
      <el-table :data="tableData">
        <!-- 表格列 -->
      </el-table>
      <!-- 分页 -->
    </div>

    <!-- 弹窗 -->
    <el-dialog v-model="dialogVisible">
      <!-- 表单 -->
    </el-dialog>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, onMounted } from 'vue'
// 导入 API 和工具函数
// 业务逻辑
</script>

<style scoped lang="scss">
// 组件样式
</style>
```

### 7.3 核心页面说明

#### 7.3.1 登录页 `Login.vue`

**特色功能**:
- **角色滑块**: 水平滑动切换登录角色（学生/教师/管理员）
- **视觉设计**: 左侧系统信息展示，右侧表单
- **品牌标识**: LAB·OS 系统名称，科技感设计

**登录流程**:
```
输入用户名密码 -> 校验 -> 调用 login API ->
获取 Token 和用户信息 -> 存储到 Pinia 和 localStorage ->
跳转到 Dashboard 或 redirect 页面
```

#### 7.3.2 仪表盘 `Dashboard.vue`

**功能**:
- **统计卡片**: 根据角色显示不同统计项（实验室数、设备数、我的预约、待审批等）
- **图表展示**: ECharts 饼图（设备状态分布）、柱状图（实验室使用频次）
- **预约列表**: 显示近期预约，支持点击跳转到预约管理页

**角色差异**:
- 管理员: 看到全部统计数据和所有预约
- 教师: 看到自己课程的预约和待审批数量
- 学生: 看到自己的预约统计

#### 7.3.3 日历视图 `LabCalendar.vue`

**功能**:
- **月视图/周视图切换**: 两种展示模式
- **实验室筛选**: 下拉选择特定实验室
- **预约事件**: 在日历格中显示预约条，颜色区分状态
- **详情弹窗**: 点击预约显示详细信息

**实现方式**:
- 自定义日历渲染（不使用第三方日历组件）
- 根据 `currentDate` 计算月份/周日期
- 从 API 获取预约事件，按日期分组

#### 7.3.4 实验室/设备列表 `LabList.vue` / `DeviceList.vue`

**通用功能**:
- **搜索筛选**: 按名称/状态搜索
- **分页**: 列表分页展示
- **CRUD 操作**: 新增、编辑、删除、状态更新
- **预约功能**: 学生可对空闲实验室发起预约

**角色差异**:
- 学生/教师: 只读列表，可发起预约
- 管理员: 完整 CRUD 权限

---

## 八、样式设计

### 8.1 设计规范

**设计风格**: 玻璃拟态 + 工业风格

**核心特征**:
- **无圆角**: 所有元素使用直角 (`border-radius: 0px`)
- **粗边框**: 1px 实线边框，颜色为深褐色 (`#8C6B5D`)
- **投影**: 硬阴影效果 (`box-shadow: 6px 6px 0px var(--accent-border)`)
- **主色调**: 柔和橙色 (`#FFC085`)
- **字体**: 主要使用 Inter，正文使用 JetBrains Mono 等宽字体

### 8.2 全局变量 `style.css`

```css
:root {
  --primary-color: #FFC085;       /* 主色调 - 柔和橙 */
  --primary-dark: #FFA940;
  --accent-border: #8C6B5D;      /* 边框色 - 深褐 */
  --text-main: #4A403A;           /* 主要文字色 */
  --text-light: #9D8D85;          /* 次要文字色 */
  --success-color: #10b981;
  --warning-color: #f59e0b;
  --danger-color: #ef4444;

  --glass-bg: #ffffff;
  --glass-border: 1px solid var(--accent-border);
  --glass-shadow: 6px 6px 0px var(--accent-border);
  --glass-shadow-hover: 8px 8px 0px var(--accent-border);

  --border-radius-base: 0px;     /* 直角设计 */
  --transition-base: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
}
```

### 8.3 Element Plus 覆盖

全局样式对 Element Plus 组件进行了深度定制：

- **按钮**: 直角、粗体字、带投影
- **表格**: 棕色表头、橙色 hover 效果
- **弹窗**: 棕色头部、硬阴影
- **输入框**: 无阴影、下划线样式
- **标签**: 直角、小号、紧凑

---

## 九、工具函数

### 9.1 时间处理 `utils/time.ts`

```typescript
export const DISPLAY_TIME_ZONE = 'Asia/Shanghai'

export function parseDateTime(value: string): Date | null
export function formatDateTime(value: string, options?: Intl.DateTimeFormatOptions): string
export function formatTime(value: string, options?: Intl.DateTimeFormatOptions): string
export function formatDateKey(date: Date): string
```

**设计要点**:
- **时区处理**: 统一使用上海时区 (`Asia/Shanghai`)
- **格式兼容**: 处理 ISO 8601 和空格分隔的日期时间格式
- **零依赖**: 使用原生 `Intl.DateTimeFormat`，无第三方日期库依赖

---

## 十、API 接口清单

| 模块 | 接口路径 | 功能 |
|------|----------|------|
| 认证 | `/api/auth/login` | 用户登录 |
| 认证 | `/api/auth/register` | 学生注册 |
| 用户 | `/api/users/me` | 获取当前用户 |
| 用户 | `/api/users` | 用户列表 |
| 用户 | `/api/users/students` | 学生列表 |
| 实验室 | `/api/labs` | 实验室 CRUD |
| 设备 | `/api/devices` | 设备 CRUD |
| 课程 | `/api/courses` | 课程 CRUD |
| 预约 | `/api/reservations` | 预约 CRUD |
| 预约 | `/api/reservations/series` | 批量预约 |
| 预约 | `/api/reservations/course` | 课程预约 |
| 预约 | `/api/reservations/{id}/checkin` | 签到 |
| 预约 | `/api/reservations/{id}/checkout` | 签出 |
| 预约 | `/api/reservations/{id}/approve` | 审批通过 |
| 预约 | `/api/reservations/{id}/reject` | 审批拒绝 |
| 日历 | `/api/calendar` | 日历事件 |
| 通知 | `/api/notifications` | 通知列表 |
| 审计 | `/api/audit-logs` | 审计日志 |
| 配置 | `/api/rule-configs` | 规则配置 |

---

## 十一、设计亮点与最佳实践

### 11.1 架构设计

1. **分层清晰**: API层 → Store层 → 视图层，职责分明
2. **类型安全**: 全程使用 TypeScript，减少运行时错误
3. **错误处理**: 统一的响应拦截器处理各种错误场景
4. **权限控制**: 路由级别和视图级别的双重权限控制

### 11.2 代码质量

1. **注释规范**: API 函数都有 JSDoc 注释说明
2. **命名规范**: 变量、函数命名语义化
3. **模块化**: 按功能拆分，避免单个文件过大
4. **复用性**: 通用逻辑抽取为工具函数和组合式函数

### 11.3 用户体验

1. **加载状态**: 使用 Element Plus 的 `v-loading` 显示加载效果
2. **操作反馈**: 使用 `ElMessage` 和 `ElMessageBox` 给出操作反馈
3. **响应式**: 适配不同屏幕尺寸
4. **动画效果**: 页面切换、按钮 hover 等添加动画

### 11.4 可扩展性

1. **API 扩展**: 新增模块只需在 `api/` 目录下添加文件
2. **路由扩展**: 在 `router/index.ts` 添加新路由
3. **样式扩展**: CSS 变量体系便于主题切换
4. **组件扩展**: 可在 `components/` 目录下添加公共组件

---

## 十二、运行与构建

### 12.1 开发模式

```bash
npm run dev
```
启动开发服务器（http://localhost:5173）

### 12.2 生产构建

```bash
npm run build
```
编译为静态文件，输出到 `dist/` 目录

### 12.3 类型检查

```bash
npm run build
```
包含 `vue-tsc -b` 类型检查步骤

---

## 十三、总结

本前端项目采用 Vue 3 + TypeScript + Vite 技术栈，通过模块化的目录结构、统一的 API 封装、完善的类型定义，实现了可维护、可扩展的实验室管理系统前端。设计风格统一、用户体验良好，是中小型 Vue 3 项目的参考范例。

---

## 十四、视图组件详解

本章节详细介绍每个视图组件的功能、逻辑和设计理由。

### 14.1 登录注册模块

#### 14.1.1 Login.vue (`src/views/login/Login.vue`)

**功能**: 用户登录入口，支持三种角色切换登录

**核心设计**:
- **角色滑块**: 使用自定义滑块组件切换登录角色（学生/教师/管理员），比原生 Select 更具视觉冲击力
- **左右布局**: 左侧展示系统信息（品牌Logo、系统指标、终端日志），右侧为登录表单
- **响应式**: 屏幕小于 1024px 时隐藏左侧面板

**表单逻辑**:
```typescript
// 角色切换
const switchRole = (value: string, index: number) => {
  selectedRole.value = value
  activeRoleIndex.value = index
}

// 登录验证
const handleLogin = async () => {
  await formRef.value.validate(async (valid: boolean) => {
    if (!valid) return
    const res = await login({
      username: form.username,
      password: form.password,
      role: selectedRole.value  // 携带选中的角色
    })
    // 存储 Token 和用户信息后跳转到 Dashboard
  })
}
```

**样式特点**:
- 使用 JetBrains Mono 等宽字体营造科技感
- 终端日志动画效果（光标闪烁）
- 进度条展示模拟系统指标

**为什么这样设计**:
- 角色滑块前置：避免用户登录后才发现角色选错，提升用户体验
- 科技感视觉：符合实验室管理系统的专业定位

---

#### 14.1.2 Register.vue (`src/views/login/Register.vue`)

**功能**: 学生账号注册

**核心设计**:
- 与 Login.vue 保持一致的视觉风格
- 仅支持学生角色注册（教师和管理员由系统管理员创建）
- 额外的密码确认字段和邮箱验证

**表单验证**:
```typescript
// 自定义验证器：确认密码一致
const validatePass2 = (_rule: any, value: any, callback: any) => {
  if (value === '') {
    callback(new Error('请再次输入密码'))
  } else if (value !== form.password) {
    callback(new Error('两次输入密码不一致'))
  } else {
    callback()
  }
}

const rules = {
  username: [{ required: true, message: '请输入用户名', trigger: 'blur' }],
  email: [
    { required: true, message: '请输入邮箱', trigger: 'blur' },
    { type: 'email', message: '邮箱格式不正确', trigger: 'blur' }
  ],
  password: [{ required: true, message: '请输入密码', trigger: 'blur' }, { min: 6, message: '至少6位', trigger: 'blur' }],
  confirmPassword: [{ required: true, message: '请确认密码', trigger: 'blur' }, { validator: validatePass2, trigger: 'blur' }]
}
```

**为什么这样设计**:
- 限制学生注册：确保只有学生能自行注册，教师和管理员需由管理员分配
- 邮箱必填：用于接收预约审批结果、通知等

---

### 14.2 布局组件

#### 14.2.1 Layout.vue (`src/layout/Layout.vue`)

**功能**: 应用主布局，包含侧边栏导航、顶部栏和内容区

**结构**:
```
+------------------+--------------------------------------------------+
|                  |  Header: 面包屑 + 折叠按钮 + 用户下拉菜单         |
|    Sidebar       +--------------------------------------------------+
|  (动态菜单)       |                                                  |
|                  |              <router-view>                       |
|  - 实验室浏览     |                                                  |
|  - 设备浏览       |               (页面内容)                         |
|  - 我的预约       |                                                  |
|  - ...           |                                                  |
+------------------+--------------------------------------------------+
```

**核心逻辑**:
```typescript
// 根据角色过滤菜单
const menuRoutes = computed(() => {
  const userRole = userStore.userInfo?.role || 'GUEST'
  const mainRoute = router.options.routes.find(r => r.path === '/')
  if (!mainRoute || !mainRoute.children) return []

  return mainRoute.children.filter((child: any) => {
    if (child.meta && child.meta.roles) {
      return child.meta.roles.includes(userRole)  // 角色权限控制
    }
    return true
  })
})
```

**交互设计**:
- 侧边栏可折叠：点击左上角折叠按钮切换
- 用户信息展示：头像（取首字母）、姓名、角色标签
- 退出登录：清除 Token 和用户信息，跳转登录页
- 页面切换过渡动画：淡入淡出效果

**为什么这样设计**:
- 动态菜单：不同角色看到不同功能，安全性与体验兼顾
- 折叠功能：屏幕空间有限时可收起侧边栏
- 过渡动画：页面切换不突兀，提升流畅感

---

### 14.3 仪表盘

#### 14.3.1 Dashboard.vue (`src/views/dashboard/Dashboard.vue`)

**功能**: 系统首页，展示统计数据、图表和近期预约

**核心设计**:
- **角色差异化统计卡**: 根据登录角色显示不同的统计项
- **ECharts 图表**: 设备状态饼图 + 实验室使用频次柱状图
- **近期预约列表**: 管理员显示所有预约，用户显示自己的预约

**角色统计项配置**:
```typescript
const allStatItems = ref([
  { label: '实验室总数', icon: 'OfficeBuilding', roles: ['ADMIN', 'TEACHER', 'STUDENT'] },
  { label: '设备总数', icon: 'Monitor', roles: ['ADMIN', 'TEACHER', 'STUDENT'] },
  { label: '我的预约', icon: 'Calendar', roles: ['TEACHER', 'STUDENT'] },
  { label: '当前预约', icon: 'Calendar', roles: ['ADMIN'] },
  { label: '待审批', icon: 'Bell', roles: ['TEACHER', 'ADMIN'] },
])

// 根据角色过滤
const filteredStatItems = computed(() => {
  const role = userStore.role || 'STUDENT'
  return allStatItems.value.filter(item => item.roles.includes(role))
})
```

**图表初始化**:
```typescript
// 饼图：设备状态分布
const initPieChart = () => {
  deviceChart = echarts.init(deviceChartRef.value)
  deviceChart.setOption({
    series: [{
      type: 'pie',
      radius: ['40%', '70%'],
      data: [
        { value: deviceStats.idle, name: '空闲' },
        { value: deviceStats.inUse, name: '使用中' },
        { value: deviceStats.reserved, name: '预约中' },
        { value: deviceStats.maintenance, name: '维护中' }
      ]
    }]
  })
}

// 柱状图：实验室使用频次
const initBarChart = () => {
  labChart = echarts.init(labChartRef.value)
  labChart.setOption({
    xAxis: { type: 'category', data: ['周一', '周二', '周三', '周四', '周五', '周六', '周日'] },
    yAxis: { type: 'value' },
    series: [{ type: 'bar', data: [12, 8, 15, 10, 14, 3, 2] }]
  })
}
```

**为什么这样设计**:
- 统计卡可点击跳转：用户点击"设备总数"可直接跳转到设备管理页
- 图表展示直观：比数字更易理解系统整体状态
- 角色差异：管理员关注全局，学生关注自己的预约

---

### 14.4 实验室管理

#### 14.4.1 LabList.vue (`src/views/labs/LabList.vue`)

**功能**: 实验室列表查看、新增、编辑、删除、预约

**核心设计**:
- **筛选栏**: 按名称/位置搜索、按状态筛选
- **表格展示**: 名称、位置、容量、状态、操作按钮
- **角色操作差异**:
  - 管理员：完整 CRUD + 状态变更
  - 学生/教师：仅查看 + 预约空闲实验室

**状态枚举映射**:
```typescript
const getStatusType = (status: string) => {
  const map: Record<string, string> = {
    IDLE: 'success',       // 空闲 - 绿色
    IN_USE: 'warning',     // 使用中 - 橙色
    RESERVED: 'primary',   // 预约中 - 主色
    MAINTENANCE: 'danger'  // 维护中 - 红色
  }
  return map[status] || 'info'
}

const getStatusLabel = (status: string) => ({
  IDLE: '空闲', IN_USE: '使用中', RESERVED: '预约中', MAINTENANCE: '维护中'
}[status] || status)
```

**预约功能**:
```typescript
// 单次预约
const handleSingleReserve = async () => {
  await createReservation({
    labId: reserveForm.labId,
    title: reserveForm.title,
    startTime: reserveForm.timeRange[0].toISOString(),
    endTime: reserveForm.timeRange[1].toISOString()
  })
}

// 批量预约（周期预约）
const handleBatchReserve = async () => {
  await createSeriesReservation({
    labId: reserveForm.labId,
    title: reserveForm.title,
    rule: {
      type: batchForm.ruleType,  // DAILY / WEEKLY / CUSTOM
      value: batchForm.ruleType === 'WEEKLY'
        ? { daysOfWeek: batchForm.daysOfWeek, count: batchForm.weekCount * batchForm.daysOfWeek.length }
        : { count: batchForm.count, interval: batchForm.interval },
      mode: 'LENIENT'  // 跳过冲突
    },
    time: { startTime: startDateTime, endTime: endDateTime }
  })
}
```

**为什么这样设计**:
- 状态标签使用颜色区分：一眼识别实验室状态
- 批量预约支持多种模式：满足不同课程安排需求
- 管理员 vs 普通用户操作分离：安全性保障

---

### 14.5 设备管理

#### 14.5.1 DeviceList.vue (`src/views/devices/DeviceList.vue`)

**功能**: 设备列表查看、新增、编辑、删除、预约

**核心设计**:
- 与 LabList.vue 结构相似，但增加了设备特有的预约功能
- 设备预约默认进入待审批状态（需要管理员审核）

**设备状态**:
```typescript
const getStatusType = (status: string) => ({
  IDLE: 'success',       // 空闲
  IN_USE: 'warning',     // 使用中
  RESERVED: 'primary',   // 预约中
  MAINTENANCE: 'danger'  // 维护中
}[status] || 'info')
```

**批量预约结果处理**:
```typescript
// 处理批量预约结果
const data = res.data as any
const createdCount = data.created?.length || 0
const failedCount = data.failed?.length || 0

if (failedCount > 0 && createdCount > 0) {
  // 部分成功：显示成功数和失败日期
  ElMessageBox.alert(
    `成功创建 ${createdCount} 个预约，${failedCount} 个预约因冲突失败。\n\n失败日期：${failedDates}`,
    '批量预约结果',
    { type: 'warning' }
  )
} else if (failedCount > 0 && createdCount === 0) {
  // 全部失败
  ElMessage.error('所有预约都因冲突失败')
} else {
  // 全部成功
  ElMessage.success(`批量预约成功，共创建 ${createdCount} 个预约`)
}
```

**为什么这样设计**:
- 设备预约需审批：设备通常更贵重，需要管理员审核
- 显示失败详情：让用户知道哪些日期预约失败，方便调整
- 所属实验室关联：创建设备时需选择所属实验室

---

### 14.6 课程管理

#### 14.6.1 CourseList.vue (`src/views/courses/CourseList.vue`)

**功能**: 课程查看、创建、编辑、删除、绑定预约

**核心设计**:
- **双重视图**:
  - 学生视图：卡片式课程表展示
  - 教师/管理员视图：表格列表 + 操作按钮

**视图判断**:
```typescript
const isStudentView = computed(() => route.path === '/schedule' || userStore.isStudent)
const canManage = computed(() => userStore.isTeacher || userStore.isAdmin)

// 加载数据时根据角色筛选
const loadData = async () => {
  const params: any = { page: currentPage.value, pageSize: pageSize.value }
  if (userStore.isStudent) {
    params.studentId = userStore.userInfo?.id  // 学生看自己的课程
  } else if (userStore.isTeacher) {
    params.createdBy = userStore.userInfo?.id  // 教师看自己创建的课程
  }
  // 管理员看全部
}
```

**学生视图卡片**:
```html
<div class="schedule-grid">
  <div v-for="course in tableData" :key="course.id" class="schedule-card">
    <div class="course-header">
      <span class="course-name">{{ course.name }}</span>
      <span class="term-tag">{{ course.term }}</span>
    </div>
    <div class="course-info">
      <div class="info-item">
        <el-icon><User /></el-icon>
        <span>{{ course.teacherName || '待定' }}</span>
      </div>
      <!-- 更多信息... -->
    </div>
  </div>
</div>
```

**为什么这样设计**:
- 卡片视图更适合学生：直观展示课程安排
- 教师看自己创建的课程：责任到人
- 课程绑定预约：教师可为课程批量创建周期预约

---

### 14.7 预约管理

#### 14.7.1 ReservationList.vue (`src/views/reservations/ReservationList.vue`)

**功能**: 预约列表查看、发起预约、审批、取消、详情

**核心设计**:
- **三种视图模式**:
  - 我的预约 (`/my-reservations`)：学生/教师查看自己的预约
  - 预约审批 (`/approval`)：教师审批待处理预约
  - 预约管理 (`/reservations`)：管理员管理所有预约

**视图模式判断**:
```typescript
const viewMode = computed(() => {
  if (route.path === '/my-reservations') return 'my'
  if (route.path === '/approval') return 'approval'
  return 'manage'
})
```

**审批操作**:
```typescript
// 通过预约
const handleApprove = (row: any) => {
  ElMessageBox.confirm('确定通过该预约吗？', '审批确认', { type: 'success' })
    .then(async () => {
      await approveReservation(row.id)
      ElMessage.success('已批准该预约')
      loadData()
    })
}

// 驳回预约
const handleReject = (row: any) => {
  ElMessageBox.prompt('请输入驳回原因', '驳回预约', { inputPattern: /.+/, inputErrorMessage: '请输入原因' })
    .then(async ({ value }) => {
      await rejectReservation(row.id, { reason: value })
      ElMessage.info('已驳回该预约')
      loadData()
    })
}
```

**列表/日历切换**:
```typescript
const displayMode = ref<'list' | 'calendar'>('list')

// 日历视图数据处理
const reservationsByDate = computed(() => {
  const map: Record<string, any[]> = {}
  tableData.value.forEach(item => {
    const dateKey = toLocalDateKey(item.startTime)
    if (dateKey) {
      if (!map[dateKey]) map[dateKey] = []
      map[dateKey].push(item)
    }
  })
  return map
})
```

**为什么这样设计**:
- 三种视图对应不同角色需求：学生看自己、教师审批、管理员全局管理
- 列表/日历切换：满足不同查看习惯
- 审批需要确认/输入原因：防止误操作，记录审批依据

---

### 14.8 预约日历

#### 14.8.1 LabCalendar.vue (`src/views/calendar/LabCalendar.vue`)

**功能**: 可视化日历展示预约，支持月视图/周视图切换

**核心设计**:
- **自定义日历渲染**: 不使用 Element Plus Calendar，手动实现月/周视图
- **实验室筛选**: 下拉选择特定实验室查看
- **预约事件**: 在日历格中显示预约条，颜色区分状态

**日历数据计算**:
```typescript
// 月视图：补齐到 42 天（6行7列）
const monthDays = computed(() => {
  const year = currentDate.value.getFullYear()
  const month = currentDate.value.getMonth()
  const firstDayOfMonth = new Date(year, month, 1)
  const startDay = firstDayOfMonth.getDay()  // 0-6
  const totalDays = lastDayOfMonth.getDate()

  const days: any[] = []
  // 上月补齐
  for (let i = startDay - 1; i >= 0; i--) {
    const d = new Date(year, month, -i)
    days.push({ date: d, dayNum: d.getDate(), isCurrentMonth: false, events: getEventsForDate(...) })
  }
  // 当月
  for (let i = 1; i <= totalDays; i++) {
    const d = new Date(year, month, i)
    days.push({ date: d, dayNum: i, isCurrentMonth: true, events: getEventsForDate(...) })
  }
  // 下月补齐
  const remaining = 42 - days.length
  for (let i = 1; i <= remaining; i++) {
    const d = new Date(year, month + 1, i)
    days.push({ date: d, dayNum: i, isCurrentMonth: false, events: getEventsForDate(...) })
  }
  return days
})

// 周视图
const weekViewDays = computed(() => {
  const curr = new Date(currentDate.value)
  const day = curr.getDay()
  const weekStart = new Date(curr.setDate(curr.getDate() - day))

  const days: any[] = []
  for (let i = 0; i < 7; i++) {
    const d = new Date(weekStart)
    d.setDate(weekStart.getDate() + i)
    days.push({ date: d, dayNum: d.getDate(), isToday: isToday(d), events: getEventsForDate(...) })
  }
  return days
})
```

**预约事件样式**:
```typescript
const getEventStatusClass = (status: string) => ({
  APPROVED: 'status-approved',    // 绿色边框
  PENDING: 'status-pending',      // 橙色边框
  IN_USE: 'status-in-use',        // 主色边框
  REJECTED: 'status-rejected'     // 红色边框
}[status] || '')
```

**为什么这样设计**:
- 自定义日历比组件更灵活：可控制每个格子的样式和交互
- 月/周视图切换：月视图看整体，周视图看细节
- 实验室筛选：专注查看特定实验室的预约情况
- 演示数据兜底：API 无数据时显示模拟数据，避免空白尴尬

---

### 14.9 管理员功能

#### 14.9.1 UserList.vue (`src/views/admin/UserList.vue`)

**功能**: 用户列表管理，包括搜索、筛选、编辑、重置密码

**核心设计**:
- 管理员专属页面
- 支持按角色、状态筛选
- 支持姓名/邮箱/电话搜索
- 可编辑用户信息、重置密码

**搜索与筛选**:
```typescript
const loadData = async () => {
  const params: any = { page: currentPage.value, pageSize: pageSize.value }
  if (roleFilter.value) params.role = roleFilter.value
  if (statusFilter.value) params.status = statusFilter.value

  const res = await getUserList(params)
  tableData.value = res.data.items || []
  total.value = res.data.total || 0

  // 前端搜索过滤（简单场景）
  if (searchQuery.value) {
    tableData.value = tableData.value.filter(u =>
      u.name.includes(searchQuery.value) ||
      (u.email && u.email.includes(searchQuery.value)) ||
      (u.phone && u.phone.includes(searchQuery.value))
    )
  }
}
```

**重置密码**:
```typescript
const handleResetPassword = (row: any) => {
  ElMessageBox.confirm(
    `确定要重置用户 "${row.name}" 的密码吗？密码将被重置为：123456`,
    '重置密码',
    { type: 'warning' }
  ).then(async () => {
    await resetPassword(row.id)
    ElMessage.success('密码已重置为：123456')
  })
}
```

**为什么这样设计**:
- 密码重置为默认密码：安全性考量，避免直接看到密码
- 前端搜索+后端分页：简单场景下体验更好

---

#### 14.9.2 AuditLogs.vue (`src/views/admin/AuditLogs.vue`)

**功能**: 系统审计日志查看，支持按对象类型筛选

**核心设计**:
- 管理员专属页面
- 展示所有用户操作记录
- 按对象类型筛选（实验室、设备、预约、用户等）

**日志格式化**:
```typescript
// 操作类型中文映射
const formatAction = (action: string) => {
  const actionMap: Record<string, string> = {
    CREATE: '创建',
    UPDATE: '更新',
    DELETE: '删除',
    RESERVATION_CREATE: '创建预约',
    RESERVATION_APPROVE: '批准预约',
    RESERVATION_REJECT: '拒绝预约',
    LOGIN: '登录认证',
    // ... 更多操作
  }
  return actionMap[action] || action
}

// 颜色映射
const getActionType = (action: string) => {
  if (action.includes('CREATE') || action.includes('APPROVE') || action === 'LOGIN') return 'success'
  if (action.includes('UPDATE') || action.includes('CHANGE') || action.includes('CANCEL')) return 'warning'
  if (action.includes('DELETE') || action.includes('REJECT')) return 'danger'
  return 'info'
}
```

**为什么这样设计**:
- 审计日志是安全运营的重要依据
- 按类型筛选方便定位问题
- 详细的操作记录便于追溯
