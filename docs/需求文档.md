# 智能实验室预约与设备管理系统 需求文档（待确认）

## 1. 背景与目标
- 背景：为学校实验室提供预约与设备管理能力，解决时间冲突与资源分配问题。
- 核心目标：实现支持复杂规则校验的资源预约与管理平台，覆盖实验室、设备、课程三类核心对象。

## 2. 用户角色与需求
### 2.1 管理员
- 实验室与设备的全生命周期管理（新增/编辑/停用/维护）。
- 维护实验室/设备状态与维护计划。
- 审批或强制调整预约（处理冲突、违规、紧急调度）。
- 全局视图：按实验室/设备/时间段查看预约与使用情况。

### 2.2 教师
- 发起预约并绑定课程（课程绑定预约）。
- 进行单次预约与多次预约（重复规则设置）。
- 查看个人课程与预约记录。
- 对学生预约进行授权或限制（可选）。

### 2.3 学生
- 进行单次预约（依据可用资源与开放规则）。
- 查看个人预约、状态与历史记录。
- 取消或变更预约（在规则允许范围内）。

## 3. 预约场景定义
### 3.1 单次预约
- 用户选择实验室、设备、时间段。
- 系统校验冲突与规则后生成预约。

### 3.2 多次预约
- 支持按周/按日/按固定周期的重复预约。
- 需要校验每个时间段的冲突，若部分冲突可选择：
  - 全部失败（严格模式）
  - 可用部分提交（宽松模式）

### 3.3 课程绑定预约
- 教师将预约绑定课程计划。
- 课程信息（课程名、班级、人数、时间、学期）与实验室资源关联。
- 课程预约优先级高于普通预约（可配置）。

## 4. 实验室与设备状态机模型
### 4.1 实验室状态
- 空闲（Idle）
- 已预约（Reserved）
- 使用中（InUse）
- 维护中（Maintenance）
- 停用（Disabled）

状态迁移示例：
- 空闲 -> 已预约（预约成功）
- 已预约 -> 使用中（到达预约时间且签到）
- 已预约 -> 空闲（预约取消或过期）
- 使用中 -> 空闲（使用结束）
- 任意 -> 维护中（管理员设置维护）
- 维护中 -> 空闲（维护完成）
- 任意 -> 停用（管理员停用）

### 4.2 设备状态
- 空闲（Idle）
- 已预约（Reserved）
- 使用中（InUse）
- 维护中（Maintenance）
- 报废（Retired）

状态迁移与实验室类似，但包含报废终态。

## 5. 冲突检测与规则
### 5.1 冲突定义
- 同一实验室或设备在重叠时间段不可被重复预约。
- 维护中的实验室/设备不可被预约。
- 课程绑定预约优先级可覆盖普通预约（若管理员允许）。

### 5.2 冲突检测算法（建议）
- 时间段重叠判断：
  - 若 startA < endB 且 endA > startB 则视为冲突。
- 多次预约需对每个实例时间段进行校验。
- 在数据库层采用范围查询或唯一约束（视DB能力），应用层进行详细规则校验。

### 5.3 规则配置
- 可配置预约提前时间/最晚取消时间。
- 可设置每角色每日/每周预约上限。
- 可配置课程预约优先级与抢占策略。

### 5.4 预约修改/取消与审核规则（补充）
- 角色差异时间窗：教师开始前 ≥ 12 小时可改/取消；学生开始前 ≥ 24 小时可改/取消。
- 超出时间窗的修改/取消仅管理员可强制调整，并需填写简短原因。
- 修改预约需重新进行冲突校验与规则校验。
- 课程绑定预约的调整优先走管理员审核通道（简化为“提交-审核-生效”三步）。
- 取消成功后应释放对应实验室/设备资源，并通知相关用户。

## 6. 功能范围
### 6.1 实验室管理
- 实验室信息维护（名称、容量、位置、开放时间）。
- 实验室状态管理（维护/停用）。

### 6.2 设备管理
- 设备信息维护（名称、型号、所属实验室、状态）。
- 设备状态管理（维护/报废）。

### 6.3 预约管理
- 创建/取消/修改预约。
- 预约冲突校验与规则校验。
- 支持三类预约场景。

### 6.4 权限控制
- 基于角色的访问控制（RBAC）。
- 管理员拥有全权限；教师/学生权限受限。

### 6.5 预约展示
- 列表与日历视图展示预约情况。
- 查询过滤：按实验室、设备、时间范围、状态。

## 7. 非功能性需求
- 可用性：支持多角色并发使用。
- 可维护性：日志、审计、操作记录清晰。
- 可扩展性：规则引擎可扩展，新增资源类型成本可控。

## 8. 交付与验收（草案）
- 后端：Spring Boot 实现实验室/设备/预约/权限模块。
- 冲突检测算法：提供单元测试覆盖边界情况。
- 前端：提供简单预约流程演示页面。
- 扩展：集成日历视图展示预约情况。

## 9. 待确认问题
已确认：
- 多次预约冲突时采用部分提交，并提醒未预约成功的时段。
- 课程绑定预约允许覆盖普通预约。
- 设备必须绑定实验室。
- 需要管理员审核流程，但尽量简洁。
- 预约修改/取消时间限制采用角色差异：教师开始前 ≥ 12 小时可改/取消；学生开始前 ≥ 24 小时可改/取消。
